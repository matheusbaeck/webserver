<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .comments-section {
            max-width: 600px;
            margin: 20px auto;
        }
        .comment {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="comments-section">
        <h1>Comments</h1>
        <div id="comments-list"></div>
        <form id="comment-form">
            <textarea id="comment-input" rows="4" cols="50" placeholder="Write your comment here..." required></textarea><br>
            <button type="submit">Submit</button>
        </form>
    </div>

    <script>
        const commentsList = document.getElementById('comments-list');
        const commentForm = document.getElementById('comment-form');
        const commentInput = document.getElementById('comment-input');
        const endpoint = 'http://localhost:2525/cgi/comments.py';

        // Fetch existing comments and display them
        async function fetchComments() {
            try {
                const response = await fetch(endpoint); // Adjust the URL if needed
                const comments = await response.json();

                // Clear the list
                commentsList.innerHTML = '';

                // Display each comment
                comments.forEach(comment => {
                    const div = document.createElement('div');
                    div.className = 'comment';
                    div.textContent = comment.trim();
                    commentsList.appendChild(div);
                });
            } catch (error) {
                console.error('Error fetching comments:', error);
            }
        }

        // Submit a new comment
        commentForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent the default form submission behavior

            const newComment = commentInput.value;

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `comment=${encodeURIComponent(newComment)}`
                });

                console.log(response.ok);

                location.reload();

                if (response.ok) {
                    commentInput.value = ''; // Clear the input
                    fetchComments(); // Refresh the comments list
                    //location.reload();
                } else {
                    console.error('Error submitting comment:', response.statusText);
                }
            } catch (error) {
                console.error('Error submitting comment:', error);
            }
        });

        // Fetch comments when the page loads
        fetchComments();
    </script>
</body>
</html>

